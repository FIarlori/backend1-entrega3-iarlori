{{> header}}
<h1>Lista de Productos</h1>

{{#if error}}
    <p class="error-message">Error: {{error}}</p>
{{/if}}

<!-- Formulario para filtros y ordenamiento -->
<form id="filterForm" action="/products" method="GET">
    <label for="limit">Límite:</label>
    <input type="number" id="limit" name="limit" value="{{limit}}" min="1" placeholder="10">
    
    <label for="page">Página:</label>
    <input type="number" id="page" name="page" value="{{page}}" min="1" placeholder="1">
    
    <label for="available">Solo disponibles (stock > 0):</label>
    <input type="checkbox" id="available" name="available" {{#if available}}checked{{/if}} value="true">
    
    <label for="category">Categoría:</label>
    <input type="text" id="category" name="category" value="{{category}}" placeholder="Ej: Periféricos">
    
    <label for="sort">Ordenar por precio:</label>
    <select id="sort" name="sort">
        <option value="" {{#unless sort}}selected{{/unless}}>Sin orden</option>
        <option value="asc" {{#if (eq sort 'asc')}}selected{{/if}}>Ascendente</option>
        <option value="desc" {{#if (eq sort 'desc')}}selected{{/if}}>Descendente</option>
    </select>
    
    <button type="submit">Aplicar Filtros</button>
</form>

<ul id="productsList">
    {{#if payload.length}}
        {{#each payload}}
            <li>
                <div>
                    <strong>{{this.title}}</strong> - ${{this.price}}
                    <br>{{this.description}}
                    <br>Stock: {{this.stock}} | Categoría: {{this.category}}
                    {{#if this.thumbnails.length}}
                        <br><img src="{{this.thumbnails.[0]}}" width="50" alt="{{this.title}}">
                    {{/if}}
                    <br><a href="/products/{{this._id}}">Ver Detalles</a>
                    <button onclick="addToCart('{{this._id}}', '{{../cartId}}', event)" {{#if (eq this.stock 0)}}disabled{{/if}}>Agregar al Carrito</button>
                </div>
            </li>
        {{/each}}
    {{else}}
        <li class="no-products">No hay productos disponibles.</li>
    {{/if}}
</ul>

<div class="pagination">
    {{#if hasPrevPage}}
        <a href="{{prevLink}}" class="nav-link">Página Anterior</a>
    {{else}}
    {{/if}}
    <span>Página {{page}} de {{totalPages}}</span>
    {{#if hasNextPage}}
        <a href="{{nextLink}}" class="nav-link">Página Siguiente</a>
    {{else}}
    {{/if}}
</div>

<a href="/realtimeproducts" class="nav-link">Ir a Vista en Tiempo Real</a>
<a href="/cart" class="nav-link">Ver Carrito</a>
{{> footer}}

<script src="/js/home.js"></script>